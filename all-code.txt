Project: leadnurturing - concatenated source export
Generated: 2026-02-16

--- TOP-LEVEL FILES ---

----- pom.xml -----
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>4.0.2</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.hero</groupId>
    <artifactId>leadnurturing</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>leadnurturing</name>
    <description>Lead Nurturing CRM Backend Application</description>
    <url/>
    <licenses>
        <license/>
    </licenses>
    <developers>
        <developer/>
    </developers>
    <scm>
        <connection/>
        <developerConnection/>
        <tag/>
        <url/>
    </scm>
    <properties>
        <java.version>21</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-mail</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-webmvc</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.projectlombok</groupId>
            <artifactId>lombok</artifactId>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-mail-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-security-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-validation-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-webmvc-test</artifactId>
            <scope>test</scope>
        </dependency>
        <dependency>
            <groupId>org.springdoc</groupId>
            <artifactId>springdoc-openapi-starter-webmvc-ui</artifactId>
            <version>2.3.0</version>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-api</artifactId>
            <version>0.12.3</version>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-impl</artifactId>
            <version>0.12.3</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>io.jsonwebtoken</groupId>
            <artifactId>jjwt-jackson</artifactId>
            <version>0.12.3</version>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.apache.poi</groupId>
            <artifactId>poi-ooxml</artifactId>
            <version>5.2.5</version>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <dependency>
            <groupId>com.mysql</groupId>
            <artifactId>mysql-connector-j</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>

    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <configuration>
                    <annotationProcessorPaths>
                        <path>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </path>
                    </annotationProcessorPaths>
                </configuration>
            </plugin>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
                <configuration>
                    <excludes>
                        <exclude>
                            <groupId>org.projectlombok</groupId>
                            <artifactId>lombok</artifactId>
                        </exclude>
                    </excludes>
                </configuration>
            </plugin>
        </plugins>
    </build>

</project>


----- HELP.md -----
# Getting Started

### Reference Documentation
For further reference, please consider the following sections:

* [Official Apache Maven documentation](https://maven.apache.org/guides/index.html)
* [Spring Boot Maven Plugin Reference Guide](https://docs.spring.io/spring-boot/4.0.2/maven-plugin)
* [Create an OCI image](https://docs.spring.io/spring-boot/4.0.2/maven-plugin/build-image.html)
* [Spring Web](https://docs.spring.io/spring-boot/4.0.2/reference/web/servlet.html)
* [Spring Security](https://docs.spring.io/spring-boot/4.0.2/reference/web/spring-security.html)
* [Java Mail Sender](https://docs.spring.io/spring-boot/4.0.2/reference/io/email.html)
* [Validation](https://docs.spring.io/spring-boot/4.0.2/reference/io/validation.html)
* [Spring Boot DevTools](https://docs.spring.io/spring-boot/4.0.2/reference/using/devtools.html)

### Guides
The following guides illustrate how to use some features concretely:

* [Building a RESTful Web Service](https://spring.io/guides/gs/rest-service/)
* [Serving Web Content with Spring MVC](https://spring.io/guides/gs/serving-web-content/)
* [Building REST services with Spring](https://spring.io/guides/tutorials/rest/)
* [Securing a Web Application](https://spring.io/guides/gs/securing-web/)
* [Spring Boot and OAuth2](https://spring.io/guides/tutorials/spring-boot-oauth2/)
* [Authenticating a User with LDAP](https://spring.io/guides/gs/authenticating-ldap/)
* [Validation](https://spring.io/guides/gs/validating-form-input/)

### Maven Parent overrides

Due to Maven's design, elements are inherited from the parent POM to the project POM.
While most of the inheritance is fine, it also inherits unwanted elements like `<license>` and `<developers>` from the parent.
To prevent this, the project POM contains empty overrides for these elements.
If you manually switch to a different parent and actually want the inheritance, you need to remove those overrides.



----- mvnw -----
#!/bin/sh
# ----------------------------------------------------------------------------
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#    http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
# ----------------------------------------------------------------------------

# ----------------------------------------------------------------------------
# Apache Maven Wrapper startup batch script, version 3.3.4
#
# Optional ENV vars
# -----------------
#   JAVA_HOME - location of a JDK home dir, required when download maven via java source
#   MVNW_REPOURL - repo url base for downloading maven distribution
#   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
#   MVNW_VERBOSE - true: enable verbose log; debug: trace the mvnw script; others: silence the output
# ----------------------------------------------------------------------------

set -euf
[ "${MVNW_VERBOSE-}" != debug ] || set -x

# OS specific support.
native_path() { printf %s\\n "$1"; }
case "$(uname)" in
CYGWIN* | MINGW*)
  [ -z "${JAVA_HOME-}" ] || JAVA_HOME="$(cygpath --unix "$JAVA_HOME")"
  native_path() { cygpath --path --windows "$1"; }
  ;;
esac

# set JAVACMD and JAVACCMD
set_java_home() {
  # For Cygwin and MinGW, ensure paths are in Unix format before anything is touched
  if [ -n "${JAVA_HOME-}" ]; then
    if [ -x "$JAVA_HOME/jre/sh/java" ]; then
      # IBM's JDK on AIX uses strange locations for the executables
      JAVACMD="$JAVA_HOME/jre/sh/java"
      JAVACCMD="$JAVA_HOME/jre/sh/javac"
    else
      JAVACMD="$JAVA_HOME/bin/java"
      JAVACCMD="$JAVA_HOME/bin/javac"

      if [ ! -x "$JAVACMD" ] || [ ! -x "$JAVACCMD" ]; then
        echo "The JAVA_HOME environment variable is not defined correctly, so mvnw cannot run." >&2
        echo "JAVA_HOME is set to \"$JAVA_HOME\", but \"\$JAVA_HOME/bin/java\" or \"\$JAVA_HOME/bin/javac\" does not exist." >&2
        return 1
      fi
    fi
  else
    JAVACMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v java
    )" || :
    JAVACCMD="$(
      'set' +e
      'unset' -f command 2>/dev/null
      'command' -v javac
    )" || :

    if [ ! -x "${JAVACMD-}" ] || [ ! -x "${JAVACCMD-}" ]; then
      echo "The java/javac command does not exist in PATH nor is JAVA_HOME set, so mvnw cannot run." >&2
      return 1
    fi
  fi
}

# hash string like Java String::hashCode
hash_string() {
  str="${1:-}" h=0
  while [ -n "$str" ]; do
    char="${str%"${str#?}"}"
    h=$(((h * 31 + $(LC_CTYPE=C printf %d "'$char")) % 4294967296))
    str="${str#?}"
  done
  printf %x\\n $h
}

verbose() { :; }
[ "${MVNW_VERBOSE-}" != true ] || verbose() { printf %s\\n "${1-}"; }

die() {
  printf %s\\n "$1" >&2
  exit 1
}

trim() {
  # MWRAPPER-139:
  #   Trims trailing and leading whitespace, carriage returns, tabs, and linefeeds.
  #   Needed for removing poorly interpreted newline sequences when running in more
  #   exotic environments such as mingw bash on Windows.
  printf "%s" "${1}" | tr -d '[:space:]'
}

scriptDir="$(dirname "$0")"
scriptName="$(basename "$0")"

# parse distributionUrl and optional distributionSha256Sum, requires .mvn/wrapper/maven-wrapper.properties
while IFS="=" read -r key value; do
  case "${key-}" in
  distributionUrl) distributionUrl=$(trim "${value-}") ;;
  distributionSha256Sum) distributionSha256Sum=$(trim "${value-}") ;;
  esac
done <"$scriptDir/.mvn/wrapper/maven-wrapper.properties"
[ -n "${distributionUrl-}" ] || die "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"

case "${distributionUrl##*/}" in
maven-mvnd-*bin.*)
  MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/
  case "${PROCESSOR_ARCHITECTURE-}${PROCESSOR_ARCHITEW6432-}:$(uname -a)" in
  *AMD64:CYGWIN* | *AMD64:MINGW*) distributionPlatform=windows-amd64 ;;
  :Darwin*x86_64) distributionPlatform=darwin-amd64 ;;
  :Darwin*arm64) distributionPlatform=darwin-aarch64 ;;
  :Linux*x86_64*) distributionPlatform=linux-amd64 ;;
  *)
    echo "Cannot detect native platform for mvnd on $(uname)-$(uname -m), use pure java version" >&2
    distributionPlatform=linux-amd64
    ;;
  esac
  distributionUrl="${distributionUrl%-bin.*}-$distributionPlatform.zip"
  ;;
maven-mvnd-*) MVN_CMD=mvnd.sh _MVNW_REPO_PATTERN=/maven/mvnd/ ;;
*) MVN_CMD="mvn${scriptName#mvnw}" _MVNW_REPO_PATTERN=/org/apache/maven/ ;;
esac

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
[ -z "${MVNW_REPOURL-}" ] || distributionUrl="$MVNW_REPOURL$_MVNW_REPO_PATTERN${distributionUrl#*"$_MVNW_REPO_PATTERN"}"
distributionUrlName="${distributionUrl##*/}"
distributionUrlNameMain="${distributionUrlName%.*}"
distributionUrlNameMain="${distributionUrlNameMain%-bin}"
MAVEN_USER_HOME="${MAVEN_USER_HOME:-${HOME}/.m2}"
MAVEN_HOME="${MAVEN_USER_HOME}/wrapper/dists/${distributionUrlNameMain-}/$(hash_string "$distributionUrl")"

exec_maven() {
  unset MVNW_VERBOSE MVNW_USERNAME MVNW_PASSWORD MVNW_REPOURL || :
  exec "$MAVEN_HOME/bin/$MVN_CMD" "$@" || die "cannot exec $MAVEN_HOME/bin/$MVN_CMD"
}

if [ -d "$MAVEN_HOME" ]; then
  verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  exec_maven "$@"
fi

case "${distributionUrl-}" in
*?-bin.zip | *?maven-mvnd-?*-?*.zip) ;;
*) die "distributionUrl is not valid, must match *-bin.zip or maven-mvnd-*.zip, but found '${distributionUrl-}'" ;;
esac

# prepare tmp dir
if TMP_DOWNLOAD_DIR="$(mktemp -d)" && [ -d "$TMP_DOWNLOAD_DIR" ]; then
  clean() { rm -rf -- "$TMP_DOWNLOAD_DIR"; }
  trap clean HUP INT TERM EXIT
else
  die "cannot create temp dir"
fi

mkdir -p -- "${MAVEN_HOME%/*}"

# Download and Install Apache Maven
verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
verbose "Downloading from: $distributionUrl"
verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

# select .zip or .tar.gz
if ! command -v unzip >/dev/null; then
  distributionUrl="${distributionUrl%.zip}.tar.gz"
  distributionUrlName="${distributionUrl##*/}"
fi

# verbose opt
__MVNW_QUIET_WGET=--quiet __MVNW_QUIET_CURL=--silent __MVNW_QUIET_UNZIP=-q __MVNW_QUIET_TAR=''
[ "${MVNW_VERBOSE-}" != true ] || __MVNW_QUIET_WGET='' __MVNW_QUIET_CURL='' __MVNW_QUIET_UNZIP='' __MVNW_QUIET_TAR=v

# normalize http auth
case "${MVNW_PASSWORD:+has-password}" in
'') MVNW_USERNAME='' MVNW_PASSWORD='' ;;
has-password) [ -n "${MVNW_USERNAME-}" ] || MVNW_USERNAME='' MVNW_PASSWORD='' ;;
esac

if [ -z "${MVNW_USERNAME-}" ] && command -v wget >/dev/null; then
  verbose "Found wget ... using wget"
  wget ${__MVNW_QUIET_WGET:+"$__MVNW_QUIET_WGET"} "$distributionUrl" -O "$TMP_DOWNLOAD_DIR/$distributionUrlName" || die "wget: Failed to fetch $distributionUrl"
elif [ -z "${MVNW_USERNAME-}" ] && command -v curl >/dev/null; then
  verbose "Found curl ... using curl"
  curl ${__MVNW_QUIET_CURL:+"$__MVNW_QUIET_CURL"} -f -L -o "$TMP_DOWNLOAD_DIR/$distributionUrlName" "$distributionUrl" || die "curl: Failed to fetch $distributionUrl"
elif set_java_home; then
  verbose "Falling back to use Java to download"
  javaSource="$TMP_DOWNLOAD_DIR/Downloader.java"
  targetZip="$TMP_DOWNLOAD_DIR/$distributionUrlName"
  cat >"$javaSource" <<-END
	public class Downloader extends java.net.Authenticator
	{
	  protected java.net.PasswordAuthentication getPasswordAuthentication()
	  {
	    return new java.net.PasswordAuthentication( System.getenv( "MVNW_USERNAME" ), System.getenv( "MVNW_PASSWORD" ).toCharArray() );
	  }
	  public static void main( String[] args ) throws Exception
	  {
	    setDefault( new Downloader() );
	    java.nio.file.Files.copy( java.net.URI.create( args[0] ).toURL().openStream(), java.nio.file.Paths.get( args[1] ).toAbsolutePath().normalize() );
	  }
	}
	END
  # For Cygwin/MinGW, switch paths to Windows format before running javac and java
  verbose " - Compiling Downloader.java ..."
  "$(native_path "$JAVACCMD")" "$(native_path "$javaSource")" || die "Failed to compile Downloader.java"
  verbose " - Running Downloader.java ..."
  "$(native_path "$JAVACMD")" -cp "$(native_path "$TMP_DOWNLOAD_DIR")" Downloader "$distributionUrl" "$(native_path "$targetZip")"
fi

# If specified, validate the SHA-256 sum of the Maven distribution zip file
if [ -n "${distributionSha256Sum-}" ]; then
  distributionSha256Result=false
  if [ "$MVN_CMD" = mvnd.sh ]; then
    echo "Checksum validation is not supported for maven-mvnd." >&2
    echo "Please disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  elif command -v sha256sum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | sha256sum -c - >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  elif command -v shasum >/dev/null; then
    if echo "$distributionSha256Sum  $TMP_DOWNLOAD_DIR/$distributionUrlName" | shasum -a 256 -c >/dev/null 2>&1; then
      distributionSha256Result=true
    fi
  else
    echo "Checksum validation was requested but neither 'sha256sum' or 'shasum' are available." >&2
    echo "Please install either command, or disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties." >&2
    exit 1
  fi
  if [ $distributionSha256Result = false ]; then
    echo "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised." >&2
    echo "If you updated your Maven version, you need to update the specified distributionSha256Sum property." >&2
    exit 1
  fi
fi

# unzip and move
if command -v unzip >/dev/null; then
  unzip ${__MVNW_QUIET_UNZIP:+"$__MVNW_QUIET_UNZIP"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -d "$TMP_DOWNLOAD_DIR" || die "failed to unzip"
else
  tar xzf${__MVNW_QUIET_TAR:+"$__MVNW_QUIET_TAR"} "$TMP_DOWNLOAD_DIR/$distributionUrlName" -C "$TMP_DOWNLOAD_DIR" || die "failed to untar"
fi

# Find the actual extracted directory name (handles snapshots where filename != directory name)
actualDistributionDir=""

# First try the expected directory name (for regular distributions)
if [ -d "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain" ]; then
  if [ -f "$TMP_DOWNLOAD_DIR/$distributionUrlNameMain/bin/$MVN_CMD" ]; then
    actualDistributionDir="$distributionUrlNameMain"
  fi
fi

# If not found, search for any directory with the Maven executable (for snapshots)
if [ -z "$actualDistributionDir" ]; then
  # enable globbing to iterate over items
  set +f
  for dir in "$TMP_DOWNLOAD_DIR"/*; do
    if [ -d "$dir" ]; then
      if [ -f "$dir/bin/$MVN_CMD" ]; then
        actualDistributionDir="$(basename "$dir")"
        break
      fi
    fi
  done
  set -f
fi

if [ -z "$actualDistributionDir" ]; then
  verbose "Contents of $TMP_DOWNLOAD_DIR:"
  verbose "$(ls -la "$TMP_DOWNLOAD_DIR")"
  die "Could not find Maven distribution directory in extracted archive"
fi

verbose "Found extracted Maven distribution directory: $actualDistributionDir"
printf %s\\n "$distributionUrl" >"$TMP_DOWNLOAD_DIR/$actualDistributionDir/mvnw.url"
mv -- "$TMP_DOWNLOAD_DIR/$actualDistributionDir" "$MAVEN_HOME" || [ -d "$MAVEN_HOME" ] || die "fail to move MAVEN_HOME"

clean || :
exec_maven "$@"


----- mvnw.cmd -----
<# : batch portion
@REM ----------------------------------------------------------------------------
@REM Licensed to the Apache Software Foundation (ASF) under one
@REM or more contributor license agreements.  See the NOTICE file
@REM distributed with this work for additional information
@REM regarding copyright ownership.  The ASF licenses this file
@REM to you under the Apache License, Version 2.0 (the
@REM "License"); you may not use this file except in compliance
@REM with the License.  You may obtain a copy of the License at
@REM
@REM    http://www.apache.org/licenses/LICENSE-2.0
@REM
@REM Unless required by applicable law or agreed to in writing,
@REM software distributed under the License is distributed on an
@REM "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
@REM KIND, either express or implied.  See the License for the
@REM specific language governing permissions and limitations
@REM under the License.
@REM ----------------------------------------------------------------------------

@REM ----------------------------------------------------------------------------
@REM Apache Maven Wrapper startup batch script, version 3.3.4
@REM
@REM Optional ENV vars
@REM   MVNW_REPOURL - repo url base for downloading maven distribution
@REM   MVNW_USERNAME/MVNW_PASSWORD - user and password for downloading maven
@REM   MVNW_VERBOSE - true: enable verbose log; others: silence the output
@REM ----------------------------------------------------------------------------

@IF "%__MVNW_ARG0_NAME__%"=="" (SET __MVNW_ARG0_NAME__=%~nx0)
@SET __MVNW_CMD__=
@SET __MVNW_ERROR__=
@SET __MVNW_PSMODULEP_SAVE=%PSModulePath%
@SET PSModulePath=
@FOR /F "usebackq tokens=1* delims==" %%A IN (`powershell -noprofile "& {$scriptDir='%~dp0'; $script='%__MVNW_ARG0_NAME__%'; icm -ScriptBlock ([Scriptblock]::Create((Get-Content -Raw '%~f0'))) -NoNewScope}"`) DO @(
  IF "%%A"=="MVN_CMD" (set __MVNW_CMD__=%%B) ELSE IF "%%B"=="" (echo %%A) ELSE (echo %%A=%%B)
)
@SET PSModulePath=%__MVNW_PSMODULEP_SAVE%
@SET __MVNW_PSMODULEP_SAVE=
@SET __MVNW_ARG0_NAME__=
@SET MVNW_USERNAME=
@SET MVNW_PASSWORD=
@IF NOT "%__MVNW_CMD__%"=="" ("%__MVNW_CMD__%" %*)
@echo Cannot start maven from wrapper >&2 && exit /b 1
@GOTO :EOF
: end batch / begin powershell #>

$ErrorActionPreference = "Stop"
if ($env:MVNW_VERBOSE -eq "true") {
  $VerbosePreference = "Continue"
}

# calculate distributionUrl, requires .mvn/wrapper/maven-wrapper.properties
$distributionUrl = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionUrl
if (!$distributionUrl) {
  Write-Error "cannot read distributionUrl property in $scriptDir/.mvn/wrapper/maven-wrapper.properties"
}

switch -wildcard -casesensitive ( $($distributionUrl -replace '^.*/','') ) {
  "maven-mvnd-*" {
    $USE_MVND = $true
    $distributionUrl = $distributionUrl -replace '-bin\.[^.]*$',"-windows-amd64.zip"
    $MVN_CMD = "mvnd.cmd"
    break
  }
  default {
    $USE_MVND = $false
    $MVN_CMD = $script -replace '^mvnw','mvn'
    break
  }
}

# apply MVNW_REPOURL and calculate MAVEN_HOME
# maven home pattern: ~/.m2/wrapper/dists/{apache-maven-<version>,maven-mvnd-<version>-<platform>}/<hash>
if ($env:MVNW_REPOURL) {
  $MVNW_REPO_PATTERN = if ($USE_MVND -eq $False) { "/org/apache/maven/" } else { "/maven/mvnd/" }
  $distributionUrl = "$env:MVNW_REPOURL$MVNW_REPO_PATTERN$($distributionUrl -replace "^.*$MVNW_REPO_PATTERN",'')"
}
$distributionUrlName = $distributionUrl -replace '^.*/',''
$distributionUrlNameMain = $distributionUrlName -replace '\.[^.]*$','' -replace '-bin$',''

$MAVEN_M2_PATH = "$HOME/.m2"
if ($env:MAVEN_USER_HOME) {
  $MAVEN_M2_PATH = "$env:MAVEN_USER_HOME"
}

if (-not (Test-Path -Path $MAVEN_M2_PATH)) {
    New-Item -Path $MAVEN_M2_PATH -ItemType Directory | Out-Null
}

$MAVEN_WRAPPER_DISTS = $null
if ((Get-Item $MAVEN_M2_PATH).Target[0] -eq $null) {
  $MAVEN_WRAPPER_DISTS = "$MAVEN_M2_PATH/wrapper/dists"
} else {
  $MAVEN_WRAPPER_DISTS = (Get-Item $MAVEN_M2_PATH).Target[0] + "/wrapper/dists"
}

$MAVEN_HOME_PARENT = "$MAVEN_WRAPPER_DISTS/$distributionUrlNameMain"
$MAVEN_HOME_NAME = ([System.Security.Cryptography.SHA256]::Create().ComputeHash([byte[]][char[]]$distributionUrl) | ForEach-Object {$_.ToString("x2")}) -join ''
$MAVEN_HOME = "$MAVEN_HOME_PARENT/$MAVEN_HOME_NAME"

if (Test-Path -Path "$MAVEN_HOME" -PathType Container) {
  Write-Verbose "found existing MAVEN_HOME at $MAVEN_HOME"
  Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"
  exit $?
}

if (! $distributionUrlNameMain -or ($distributionUrlName -eq $distributionUrlNameMain)) {
  Write-Error "distributionUrl is not valid, must end with *-bin.zip, but found $distributionUrl"
}

# prepare tmp dir
$TMP_DOWNLOAD_DIR_HOLDER = New-TemporaryFile
$TMP_DOWNLOAD_DIR = New-Item -Itemtype Directory -Path "$TMP_DOWNLOAD_DIR_HOLDER.dir"
$TMP_DOWNLOAD_DIR_HOLDER.Delete() | Out-Null
trap {
  if ($TMP_DOWNLOAD_DIR.Exists) {
    try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
    catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
  }
}

New-Item -Itemtype Directory -Path "$MAVEN_HOME_PARENT" -Force | Out-Null

# Download and Install Apache Maven
Write-Verbose "Couldn't find MAVEN_HOME, downloading and installing it ..."
Write-Verbose "Downloading from: $distributionUrl"
Write-Verbose "Downloading to: $TMP_DOWNLOAD_DIR/$distributionUrlName"

$webclient = New-Object System.Net.WebClient
if ($env:MVNW_USERNAME -and $env:MVNW_PASSWORD) {
  $webclient.Credentials = New-Object System.Net.NetworkCredential($env:MVNW_USERNAME, $env:MVNW_PASSWORD)
}
[Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
$webclient.DownloadFile($distributionUrl, "$TMP_DOWNLOAD_DIR/$distributionUrlName") | Out-Null

# If specified, validate the SHA-256 sum of the Maven distribution zip file
$distributionSha256Sum = (Get-Content -Raw "$scriptDir/.mvn/wrapper/maven-wrapper.properties" | ConvertFrom-StringData).distributionSha256Sum
if ($distributionSha256Sum) {
  if ($USE_MVND) {
    Write-Error "Checksum validation is not supported for maven-mvnd. `nPlease disable validation by removing 'distributionSha256Sum' from your maven-wrapper.properties."
  }
  Import-Module $PSHOME\Modules\Microsoft.PowerShell.Utility -Function Get-FileHash
  if ((Get-FileHash "$TMP_DOWNLOAD_DIR/$distributionUrlName" -Algorithm SHA256).Hash.ToLower() -ne $distributionSha256Sum) {
    Write-Error "Error: Failed to validate Maven distribution SHA-256, your Maven distribution might be compromised. If you updated your Maven version, you need to update the specified distributionSha256Sum property."
  }
}

# unzip and move
Expand-Archive "$TMP_DOWNLOAD_DIR/$distributionUrlName" -DestinationPath "$TMP_DOWNLOAD_DIR" | Out-Null

# Find the actual extracted directory name (handles snapshots where filename != directory name)
$actualDistributionDir = ""

# First try the expected directory name (for regular distributions)
$expectedPath = Join-Path "$TMP_DOWNLOAD_DIR" "$distributionUrlNameMain"
$expectedMvnPath = Join-Path "$expectedPath" "bin/$MVN_CMD"
if ((Test-Path -Path $expectedPath -PathType Container) -and (Test-Path -Path $expectedMvnPath -PathType Leaf)) {
  $actualDistributionDir = $distributionUrlNameMain
}

# If not found, search for any directory with the Maven executable (for snapshots)
if (!$actualDistributionDir) {
  Get-ChildItem -Path "$TMP_DOWNLOAD_DIR" -Directory | ForEach-Object {
    $testPath = Join-Path $_.FullName "bin/$MVN_CMD"
    if (Test-Path -Path $testPath -PathType Leaf) {
      $actualDistributionDir = $_.Name
    }
  }
}

if (!$actualDistributionDir) {
  Write-Error "Could not find Maven distribution directory in extracted archive"
}

Write-Verbose "Found extracted Maven distribution directory: $actualDistributionDir"
Rename-Item -Path "$TMP_DOWNLOAD_DIR/$actualDistributionDir" -NewName $MAVEN_HOME_NAME | Out-Null
try {
  Move-Item -Path "$TMP_DOWNLOAD_DIR/$MAVEN_HOME_NAME" -Destination $MAVEN_HOME_PARENT | Out-Null
} catch {
  if (! (Test-Path -Path "$MAVEN_HOME" -PathType Container)) {
    Write-Error "fail to move MAVEN_HOME"
  }
} finally {
  try { Remove-Item $TMP_DOWNLOAD_DIR -Recurse -Force | Out-Null }
  catch { Write-Warning "Cannot remove $TMP_DOWNLOAD_DIR" }
}

Write-Output "MVN_CMD=$MAVEN_HOME/bin/$MVN_CMD"


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\config\DataInitializer.java -----
package com.hero.leadnurturing.config;

import com.hero.leadnurturing.entity.User;
import com.hero.leadnurturing.entity.UserRole;
import com.hero.leadnurturing.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.boot.CommandLineRunner;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Component;

@Component
@RequiredArgsConstructor
public class DataInitializer implements CommandLineRunner {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    @Override
    public void run(String... args) {

        if (userRepository.count() == 0) {

            User hoUser = User.builder()
                    .username("ho_admin")
                    .password(passwordEncoder.encode("1234"))
                    .role(UserRole.ROLE_HO)
                    .build();

            User daUser = User.builder()
                    .username("da_agent")
                    .password(passwordEncoder.encode("1234"))
                    .role(UserRole.ROLE_DA)
                    .build();

            userRepository.save(hoUser);
            userRepository.save(daUser);

            System.out.println("Test users created!");
        }
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\config\JwtAuthenticationFilter.java -----
package com.hero.leadnurturing.config;

import java.io.IOException;

import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.web.authentication.WebAuthenticationDetailsSource;
import org.springframework.stereotype.Component;
import org.springframework.web.filter.OncePerRequestFilter;

import com.hero.leadnurturing.service.CustomUserDetailsService;

import jakarta.servlet.FilterChain;
import jakarta.servlet.ServletException;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.RequiredArgsConstructor;

@Component
@RequiredArgsConstructor
public class JwtAuthenticationFilter extends OncePerRequestFilter {

    private final JwtUtil jwtUtil;
    private final CustomUserDetailsService userDetailsService;

    @Override
    public void doFilterInternal(
            HttpServletRequest request,
            HttpServletResponse response,
            FilterChain chain)
            throws IOException, ServletException {

        String authHeader = request.getHeader("Authorization");

        if (authHeader != null && authHeader.startsWith("Bearer ")) {

            String token = authHeader.substring(7);
            if (jwtUtil.validateToken(token)) {

                String username = jwtUtil.extractUsername(token);
                var userDetails = userDetailsService.loadUserByUsername(username);

                var authToken = new UsernamePasswordAuthenticationToken(
                        userDetails,
                        null,
                        userDetails.getAuthorities()
                );

                authToken.setDetails(
                        new WebAuthenticationDetailsSource().buildDetails(request)
                );

                SecurityContextHolder.getContext().setAuthentication(authToken);
            }
        }

        chain.doFilter(request, response);
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\config\JwtUtil.java -----
package com.hero.leadnurturing.config;

import java.util.Date;

import javax.crypto.SecretKey;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import io.jsonwebtoken.JwtException;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.security.Keys;
import jakarta.annotation.PostConstruct;

@Component
public class JwtUtil {

    @Value("${jwt.secret}")
    private String secret;

    @Value("${jwt.expiration}")
    private long expiration;

    private SecretKey key;

    @PostConstruct
    public void init() {
        this.key = Keys.hmacShaKeyFor(secret.getBytes());
    }

    public String generateToken(String username) {
        return Jwts.builder()
                .subject(username)
                .issuedAt(new Date())
                .expiration(new Date(System.currentTimeMillis() + expiration))
                .signWith(key)
                .compact();
    }

    public String extractUsername(String token) {
        return Jwts.parser()
                .verifyWith(key)
                .build()
                .parseSignedClaims(token)
                .getPayload()
                .getSubject();
    }

    public boolean validateToken(String token) {
        try {
            Jwts.parser()
                    .verifyWith(key)
                    .build()
                    .parseSignedClaims(token);
            return true;
        } catch (JwtException e) {
            return false;
        }
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\config\PasswordConfig.java -----
package com.hero.leadnurturing.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class PasswordConfig {

    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\config\SecurityConfig.java -----
package com.hero.leadnurturing.config;

import java.util.Arrays;
import java.util.List;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.CorsConfigurationSource;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;

import lombok.RequiredArgsConstructor; 

@Configuration
@RequiredArgsConstructor
public class SecurityConfig {

    private final JwtAuthenticationFilter jwtFilter;

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {

        http
                .cors(cors -> {}) // enable CORS (uses corsConfigurationSource bean)
                .csrf(csrf -> csrf.disable())
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/auth/**").permitAll()
                        .requestMatchers("/api/dashboard/**").hasRole("HO")
                        .requestMatchers("/api/leads/**").hasAnyRole("HO", "DA")
                        .anyRequest().authenticated()
                )
                .sessionManagement(sess ->
                        sess.sessionCreationPolicy(SessionCreationPolicy.STATELESS)
                )
                .addFilterBefore(jwtFilter, UsernamePasswordAuthenticationFilter.class);

        return http.build();
    }

    @Bean
    public CorsConfigurationSource corsConfigurationSource() {
        CorsConfiguration configuration = new CorsConfiguration();
        configuration.setAllowedOrigins(Arrays.asList("http://localhost:5177", "http://127.0.0.1:5177"));
        configuration.setAllowedMethods(Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        configuration.setAllowedHeaders(List.of("*"));
        configuration.setAllowCredentials(true);
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", configuration);
        return source;
    }

    @Bean
    public AuthenticationManager authenticationManager(
            AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\controller\AuthController.java -----
package com.hero.leadnurturing.controller;

import org.springframework.http.ResponseEntity;
import org.springframework.security.authentication.AuthenticationManager;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.hero.leadnurturing.config.JwtUtil;
import com.hero.leadnurturing.dto.LoginRequest;
import com.hero.leadnurturing.dto.LoginResponse;
import com.hero.leadnurturing.entity.User;
import com.hero.leadnurturing.service.UserService;

import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping("/auth")
@RequiredArgsConstructor
public class AuthController {

    private final AuthenticationManager authenticationManager;
    private final UserService userService;
    private final JwtUtil jwtUtil;

    @PostMapping("/login")
    public ResponseEntity<LoginResponse> login(@RequestBody LoginRequest request) {
        Authentication authentication = authenticationManager.authenticate(
                new UsernamePasswordAuthenticationToken(request.getUsername(), request.getPassword())
        );

        User user = userService.findByUsername(request.getUsername());
        String token = jwtUtil.generateToken(user.getUsername());

        LoginResponse response = LoginResponse.builder()
                .token(token)
                .username(user.getUsername())
                .role(user.getRole().name())
                .build();

        return ResponseEntity.ok(response);
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\controller\ChatController.java -----
package com.hero.leadnurturing.controller;

import java.util.List;

import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.hero.leadnurturing.dto.ApiResponse;
import com.hero.leadnurturing.entity.ChatMessage;
import com.hero.leadnurturing.service.ChatService;

import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping("/api/chat")
@RequiredArgsConstructor
public class ChatController {

    private final ChatService chatService;

    // Send message
    @PostMapping("/{leadId}")
    public ApiResponse<ChatMessage> sendMessage(
            @PathVariable Long leadId,
            @RequestBody String message,
            Authentication authentication
    ) {

        String username = authentication.getName();

        ChatMessage chatMessage = chatService.sendMessage(leadId, username, message);
        
        return ApiResponse.<ChatMessage>builder()
                .success(true)
                .message("Message sent successfully")
                .data(chatMessage)
                .build();
    }

    // Get chat history
    @GetMapping("/{leadId}")
    public ApiResponse<List<ChatMessage>> getChatHistory(@PathVariable Long leadId) {
        List<ChatMessage> history = chatService.getChatHistory(leadId);
        return ApiResponse.<List<ChatMessage>>builder()
                .success(true)
                .message("Chat history retrieved successfully")
                .data(history)
                .build();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\controller\DashboardController.java -----
package com.hero.leadnurturing.controller;

import java.time.LocalDateTime;

import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.hero.leadnurturing.dto.ApiResponse;
import com.hero.leadnurturing.dto.DashboardStatsDTO;
import com.hero.leadnurturing.service.DashboardService;

import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping("/api/dashboard")
@RequiredArgsConstructor
public class DashboardController {

    private final DashboardService dashboardService;

    @GetMapping
    public ResponseEntity<ApiResponse<DashboardStatsDTO>> getDashboardStats(
            @RequestParam(required = false) @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime fromDate,
            @RequestParam(required = false) @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime toDate) {
        DashboardStatsDTO stats = dashboardService.getDashboardStats(fromDate, toDate);
        return ResponseEntity.ok(ApiResponse.<DashboardStatsDTO>builder()
                .success(true)
                .message("Dashboard stats retrieved successfully")
                .data(stats)
                .build());
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\controller\LeadController.java -----
package com.hero.leadnurturing.controller;

import java.time.LocalDateTime;
import java.util.List;

import org.springframework.format.annotation.DateTimeFormat;
import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

import com.hero.leadnurturing.dto.ApiResponse;
import com.hero.leadnurturing.entity.Lead;
import com.hero.leadnurturing.entity.LeadModification;
import com.hero.leadnurturing.entity.LeadStatus;
import com.hero.leadnurturing.repository.LeadModificationRepository;
import com.hero.leadnurturing.repository.LeadRepository;

import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping("/api/leads")
@RequiredArgsConstructor
public class LeadController {

    private final LeadRepository leadRepository;
    private final LeadModificationRepository leadModificationRepository;

    @PostMapping
    public ResponseEntity<ApiResponse<Lead>> createLead(@RequestBody Lead lead, Authentication authentication) {
        lead.setCreatedAt(LocalDateTime.now());
        lead.setUpdatedAt(LocalDateTime.now());
        Lead savedLead = leadRepository.save(lead);

        // Log modification
        LeadModification modification = LeadModification.builder()
                .lead(savedLead)
                .modifiedBy(authentication.getName())
                .modifiedField("CREATED")
                .oldValue(null)
                .newValue("Lead created")
                .build();
        leadModificationRepository.save(modification);

        return ResponseEntity.ok(ApiResponse.<Lead>builder()
                .success(true)
                .message("Lead created successfully")
                .data(savedLead)
                .build());
    }

    @GetMapping
    public ResponseEntity<ApiResponse<List<Lead>>> getAllLeads() {
        List<Lead> leads = leadRepository.findAll();
        return ResponseEntity.ok(ApiResponse.<List<Lead>>builder()
                .success(true)
                .message("Leads retrieved successfully")
                .data(leads)
                .build());
    }

    @GetMapping("/{id}")
    public ResponseEntity<ApiResponse<Lead>> getLeadById(@PathVariable Long id) {
        Lead lead = leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found"));
        return ResponseEntity.ok(ApiResponse.<Lead>builder()
                .success(true)
                .message("Lead retrieved successfully")
                .data(lead)
                .build());
    }

    @PutMapping("/{id}")
    public ResponseEntity<ApiResponse<Lead>> updateLead(@PathVariable Long id, @RequestBody Lead leadDetails, Authentication authentication) {
        Lead lead = leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found"));

        // Update fields
        lead.setFirstName(leadDetails.getFirstName());
        lead.setLastName(leadDetails.getLastName());
        lead.setEmail(leadDetails.getEmail());
        lead.setContactNumber(leadDetails.getContactNumber());
        lead.setCity(leadDetails.getCity());
        lead.setAddress(leadDetails.getAddress());
        lead.setModelName(leadDetails.getModelName());
        lead.setLeadSource(leadDetails.getLeadSource());
        lead.setLeadMode(leadDetails.getLeadMode());
        lead.setStatus(leadDetails.getStatus());
        lead.setFollowUpDate(leadDetails.getFollowUpDate());
        lead.setGovernmentId(leadDetails.getGovernmentId());
        lead.setUpdatedAt(LocalDateTime.now());

        Lead updatedLead = leadRepository.save(lead);

        // Log modification
        LeadModification modification = LeadModification.builder()
                .lead(updatedLead)
                .modifiedBy(authentication.getName())
                .modifiedField("UPDATED")
                .oldValue("Lead updated")
                .newValue("Fields modified")
                .build();
        leadModificationRepository.save(modification);

        return ResponseEntity.ok(ApiResponse.<Lead>builder()
                .success(true)
                .message("Lead updated successfully")
                .data(updatedLead)
                .build());
    }

    @DeleteMapping("/{id}")
    public ResponseEntity<ApiResponse<String>> deleteLead(@PathVariable Long id, Authentication authentication) {
        Lead lead = leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found"));

        // Log modification
        LeadModification modification = LeadModification.builder()
                .lead(lead)
                .modifiedBy(authentication.getName())
                .modifiedField("DELETED")
                .oldValue("Lead deleted")
                .newValue(null)
                .build();
        leadModificationRepository.save(modification);

        leadRepository.delete(lead);

        return ResponseEntity.ok(ApiResponse.<String>builder()
                .success(true)
                .message("Lead deleted successfully")
                .data("Lead deleted")
                .build());
    }

    @GetMapping("/filter/status")
    public ResponseEntity<ApiResponse<List<Lead>>> filterByStatus(@RequestParam String status) {
        LeadStatus leadStatus = LeadStatus.valueOf(status.toUpperCase());
        List<Lead> leads = leadRepository.findByStatus(leadStatus);
        return ResponseEntity.ok(ApiResponse.<List<Lead>>builder()
                .success(true)
                .message("Leads filtered by status")
                .data(leads)
                .build());
    }

    @GetMapping("/filter/city")
    public ResponseEntity<ApiResponse<List<Lead>>> filterByCity(@RequestParam String city) {
        List<Lead> leads = leadRepository.findByCity(city);
        return ResponseEntity.ok(ApiResponse.<List<Lead>>builder()
                .success(true)
                .message("Leads filtered by city")
                .data(leads)
                .build());
    }

    @GetMapping("/filter/date")
    public ResponseEntity<ApiResponse<List<Lead>>> filterByDate(
            @RequestParam @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime fromDate,
            @RequestParam @DateTimeFormat(iso = DateTimeFormat.ISO.DATE_TIME) LocalDateTime toDate) {
        List<Lead> leads = leadRepository.findByCreatedAtBetween(fromDate, toDate);
        return ResponseEntity.ok(ApiResponse.<List<Lead>>builder()
                .success(true)
                .message("Leads filtered by date")
                .data(leads)
                .build());
    }

    @GetMapping("/{id}/modifications")
    public ResponseEntity<ApiResponse<List<LeadModification>>> getModificationHistory(@PathVariable Long id) {
        Lead lead = leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found"));
        List<LeadModification> modifications = leadModificationRepository.findByLeadOrderByModifiedAtDesc(lead);
        return ResponseEntity.ok(ApiResponse.<List<LeadModification>>builder()
                .success(true)
                .message("Modification history retrieved")
                .data(modifications)
                .build());
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\controller\UploadController.java -----
package com.hero.leadnurturing.controller;

import com.hero.leadnurturing.dto.ApiResponse;
import com.hero.leadnurturing.dto.UploadResponseDTO;
import com.hero.leadnurturing.service.FileUploadService;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

@RestController
@RequestMapping("/api/upload")
@RequiredArgsConstructor
public class UploadController {

    private final FileUploadService fileUploadService;

    @PostMapping
    public ApiResponse<UploadResponseDTO> uploadFile(@RequestParam("file") MultipartFile file) {
        UploadResponseDTO result = fileUploadService.uploadLeads(file);
        return ApiResponse.<UploadResponseDTO>builder()
                .success(result.isSuccess())
                .message(result.getMessage())
                .data(result)
                .build();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\dto\ApiResponse.java -----
package com.hero.leadnurturing.dto;

import lombok.*;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class ApiResponse<T> {

    private boolean success;
    private String message;
    private T data;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\dto\DashboardStatsDTO.java -----
package com.hero.leadnurturing.dto;

import java.util.Map;

import lombok.AllArgsConstructor;
import lombok.Builder;
import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.Setter;

@Getter
@Setter
@Builder
@AllArgsConstructor
@NoArgsConstructor
public class DashboardStatsDTO {

    private long totalLeads;
    private long qualifiedLeads;
    private long unqualifiedLeads;
    private long lostLeads;
    private long pendingLeads;

    private double conversionRate;

    private Map<String, Long> sourceDistribution;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\dto\LeadResponseDTO.java -----
package com.hero.leadnurturing.dto;

import com.hero.leadnurturing.entity.LeadStatus;
import lombok.*;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class LeadResponseDTO {
    
    private Long id;
    private String contactNumber;
    private String firstName;
    private String lastName;
    private String governmentId;
    private String email;
    private String city;
    private String address;
    private String modelName;
    private String leadSource;
    private String leadMode;
    private LocalDate followUpDate;
    private LeadStatus status;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\dto\LoginRequest.java -----
package com.hero.leadnurturing.dto;

import lombok.Getter;
import lombok.Setter;

@Getter
@Setter
public class LoginRequest {
    private String username;
    private String password;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\dto\LoginResponse.java -----
package com.hero.leadnurturing.dto;

import lombok.*;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class LoginResponse {
    private String token;
    private String username;
    private String role;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\dto\UploadResponseDTO.java -----
package com.hero.leadnurturing.dto;

import lombok.*;

@Getter
@Setter
@AllArgsConstructor
@NoArgsConstructor
@Builder
public class UploadResponseDTO {
    
    private boolean success;
    private String message;
    private int totalRecords;
    private int successfulRecords;
    private int failedRecords;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\entity\ChatMessage.java -----
package com.hero.leadnurturing.entity;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "chat_messages")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class ChatMessage {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    // Many messages belong to one lead
    @ManyToOne
    @JoinColumn(name = "lead_id", nullable = false)
    private Lead lead;

    @Column(nullable = false)
    private String sender;  // HO or DA username

    @Column(nullable = false, length = 1000)
    private String message;

    private LocalDateTime timestamp;

    @PrePersist
    protected void onCreate() {
        timestamp = LocalDateTime.now();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\entity\Lead.java -----
package com.hero.leadnurturing.entity;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDate;
import java.time.LocalDateTime;

@Entity
@Table(
        name = "leads",
        uniqueConstraints = {
                @UniqueConstraint(columnNames = "contact_number"),
                @UniqueConstraint(columnNames = "government_id")
        }
)
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class Lead {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    //  BASIC DETAILS 

    @Column(name = "contact_number", nullable = false, length = 15)
    private String contactNumber;

    @Column(name = "first_name", nullable = false, length = 100)
    private String firstName;

    @Column(name = "last_name", length = 100)
    private String lastName;

    @Column(name = "government_id", length = 50)
    private String governmentId;

    @Column(name = "email", length = 150)
    private String email;

    @Column(name = "city", length = 100)
    private String city;

    @Column(name = "address", length = 255)
    private String address;

    //  LEAD DETAILS 

    @Column(name = "model_name", length = 100)
    private String modelName;

    @Column(name = "lead_source", length = 100)
    private String leadSource;

    @Column(name = "lead_mode", length = 50)
    private String leadMode; // ONLINE / OFFLINE

    @Column(name = "follow_up_date")
    private LocalDate followUpDate;

    @Enumerated(EnumType.STRING)
    @Column(name = "status")
    private LeadStatus status;

    //Audit Fields

    @Column(name = "created_at", updatable = false)
    private LocalDateTime createdAt;

    @Column(name = "updated_at")
    private LocalDateTime updatedAt;

  
//Timestamp Handling
  @PrePersist
    protected void onCreate() {
        createdAt = LocalDateTime.now();
        updatedAt = LocalDateTime.now();
        if (status == null) {
            status = LeadStatus.NEW;
        }
    }

    @PreUpdate
    protected void onUpdate() {
        updatedAt = LocalDateTime.now();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\entity\LeadModification.java -----
package com.hero.leadnurturing.entity;

import jakarta.persistence.*;
import lombok.*;

import java.time.LocalDateTime;

@Entity
@Table(name = "lead_modifications")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class LeadModification {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "lead_id", nullable = false)
    private Lead lead;

    @Column(nullable = false)
    private String modifiedField;

    @Column(length = 500)
    private String oldValue;

    @Column(length = 500)
    private String newValue;

    @Column(nullable = false)
    private String modifiedBy;

    private LocalDateTime modifiedAt;

    @PrePersist
    protected void onCreate() {
        modifiedAt = LocalDateTime.now();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\entity\LeadStatus.java -----
package com.hero.leadnurturing.entity;

public enum LeadStatus {
     NEW,
    QUALIFIED,
    UNQUALIFIED,
    LOST
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\entity\User.java -----
package com.hero.leadnurturing.entity;

import jakarta.persistence.*;
import lombok.*;

@Entity
@Table(name = "users")
@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@Builder
public class User {

    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(unique = true, nullable = false)
    private String username;

    @Column(nullable = false)
    private String password;

    @Enumerated(EnumType.STRING)
    private UserRole role;
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\entity\UserRole.java -----
package com.hero.leadnurturing.entity;

public enum UserRole {
    ROLE_HO,
    ROLE_DA
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\exception\CustomException.java -----
package com.hero.leadnurturing.exception;

public class CustomException extends Exception {
    public CustomException(String message) {
        super(message);
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\exception\GlobalExceptionHandler.java -----
package com.hero.leadnurturing.exception;

import org.springframework.http.*;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.Map;

@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(RuntimeException.class)
    public ResponseEntity<Map<String, Object>> handleRuntime(RuntimeException ex) {

        Map<String, Object> error = new HashMap<>();
        error.put("status", HttpStatus.BAD_REQUEST.value());
        error.put("message", ex.getMessage());

        return new ResponseEntity<>(error, HttpStatus.BAD_REQUEST);
    }

    @ExceptionHandler(Exception.class)
    public ResponseEntity<Map<String, Object>> handleGeneral(Exception ex) {

        Map<String, Object> error = new HashMap<>();
        error.put("status", HttpStatus.INTERNAL_SERVER_ERROR.value());
        error.put("message", "Something went wrong");

        return new ResponseEntity<>(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\LeadnurturingApplication.java -----
package com.hero.leadnurturing;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class LeadnurturingApplication {

	public static void main(String[] args) {
		SpringApplication.run(LeadnurturingApplication.class, args);
	}

}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\repository\ChatMessageRepository.java -----
package com.hero.leadnurturing.repository;

import com.hero.leadnurturing.entity.ChatMessage;
import com.hero.leadnurturing.entity.Lead;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface ChatMessageRepository extends JpaRepository<ChatMessage, Long> {

    List<ChatMessage> findByLeadOrderByTimestampAsc(Lead lead);
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\repository\LeadModificationRepository.java -----
package com.hero.leadnurturing.repository;

import com.hero.leadnurturing.entity.Lead;
import com.hero.leadnurturing.entity.LeadModification;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.List;

public interface LeadModificationRepository
        extends JpaRepository<LeadModification, Long> {

    List<LeadModification> findByLeadOrderByModifiedAtDesc(Lead lead);
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\repository\LeadRepository.java -----
package com.hero.leadnurturing.repository;

import java.time.LocalDateTime;
import java.util.List;

import com.hero.leadnurturing.entity.Lead;
import com.hero.leadnurturing.entity.LeadStatus;
import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;

public interface LeadRepository extends JpaRepository<Lead, Long> {
    //Basic Search
    List<Lead> findByStatus(LeadStatus status);

    List<Lead> findByCity(String city);

    List<Lead> findByContactNumber(String contactNumber);

    //Date Filter

     List<Lead> findByCreatedAtBetween(LocalDateTime start, LocalDateTime end);

    long countByCreatedAtBetween(LocalDateTime start, LocalDateTime end);

    long countByStatusAndCreatedAtBetween(
            LeadStatus status,
            LocalDateTime start,
            LocalDateTime end

    );

    //Dashboard Counts
    long countByStatus(LeadStatus status);

    // Group By Lead Source
    @Query("SELECT l.leadSource, COUNT(l) FROM Lead l GROUP BY l.leadSource")
    List<Object[]> countLeadsGroupedBySource();
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\repository\UserRepository.java -----
package com.hero.leadnurturing.repository;

import com.hero.leadnurturing.entity.User;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface UserRepository extends JpaRepository<User, Long> {

    Optional<User> findByUsername(String username);
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\service\ChatService.java -----
package com.hero.leadnurturing.service;

import com.hero.leadnurturing.entity.ChatMessage;
import com.hero.leadnurturing.entity.Lead;
import com.hero.leadnurturing.repository.ChatMessageRepository;
import com.hero.leadnurturing.repository.LeadRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class ChatService {

    private final ChatMessageRepository chatRepository;
    private final LeadRepository leadRepository;

    public ChatMessage sendMessage(Long leadId, String sender, String message) {

        Lead lead = leadRepository.findById(leadId)
                .orElseThrow(() -> new RuntimeException("Lead not found"));

        ChatMessage chat = ChatMessage.builder()
                .lead(lead)
                .sender(sender)
                .message(message)
                .build();

        return chatRepository.save(chat);
    }

    public List<ChatMessage> getChatHistory(Long leadId) {

        Lead lead = leadRepository.findById(leadId)
                .orElseThrow(() -> new RuntimeException("Lead not found"));

        return chatRepository.findByLeadOrderByTimestampAsc(lead);
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\service\CustomUserDetailsService.java -----
package com.hero.leadnurturing.service;

import com.hero.leadnurturing.entity.User;
import com.hero.leadnurturing.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.security.core.userdetails.*;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class CustomUserDetailsService implements UserDetailsService {

    private final UserRepository userRepository;

    @Override
    public UserDetails loadUserByUsername(String username)
            throws UsernameNotFoundException {

        User user = userRepository.findByUsername(username)
                .orElseThrow(() -> new UsernameNotFoundException("User not found"));

        return org.springframework.security.core.userdetails.User
                .builder()
                .username(user.getUsername())
                .password(user.getPassword())
                .roles(user.getRole().name().replace("ROLE_", ""))
                .build();
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\service\DashboardService.java -----
package com.hero.leadnurturing.service;

import com.hero.leadnurturing.dto.DashboardStatsDTO;
import com.hero.leadnurturing.entity.LeadStatus;
import com.hero.leadnurturing.repository.LeadRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class DashboardService {

    private final LeadRepository leadRepository;

    public DashboardStatsDTO getDashboardStats(
            LocalDateTime from,
            LocalDateTime to
    ) {

        // ===== Default: Current Month =====
        if (from == null || to == null) {
            from = LocalDateTime.now()
                    .withDayOfMonth(1)
                    .withHour(0).withMinute(0).withSecond(0);

            to = LocalDateTime.now()
                    .withDayOfMonth(
                            LocalDateTime.now()
                                    .toLocalDate()
                                    .lengthOfMonth()
                    )
                    .withHour(23).withMinute(59).withSecond(59);
        }

        long total = leadRepository.countByCreatedAtBetween(from, to);

        long qualified = leadRepository.countByStatusAndCreatedAtBetween(
                LeadStatus.QUALIFIED, from, to
        );

        long unqualified = leadRepository.countByStatusAndCreatedAtBetween(
                LeadStatus.UNQUALIFIED, from, to
        );

        long lost = leadRepository.countByStatusAndCreatedAtBetween(
                LeadStatus.LOST, from, to
        );

        long pending = total - (qualified + unqualified + lost);

        double conversion =
                total == 0 ? 0 :
                        ((double) qualified / total) * 100;

        return DashboardStatsDTO.builder()
                .totalLeads(total)
                .qualifiedLeads(qualified)
                .unqualifiedLeads(unqualified)
                .lostLeads(lost)
                .pendingLeads(pending)
                .conversionRate(conversion)
                .sourceDistribution(getLeadsBySource())
                .build();
    }

    // ===== Source Distribution =====
    private Map<String, Long> getLeadsBySource() {

        List<Object[]> results = leadRepository.countLeadsGroupedBySource();

        Map<String, Long> response = new HashMap<>();

        for (Object[] row : results) {
            String source = (String) row[0];
            Long count = (Long) row[1];
            response.put(source, count);
        }

        return response;
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\service\FileUploadService.java -----
package com.hero.leadnurturing.service;

import com.hero.leadnurturing.dto.UploadResponseDTO;
import com.hero.leadnurturing.entity.Lead;
import com.hero.leadnurturing.repository.LeadRepository;
import lombok.RequiredArgsConstructor;
import org.apache.poi.ss.usermodel.*;
import org.springframework.stereotype.Service;
import org.springframework.web.multipart.MultipartFile;

import java.io.InputStream;

@Service
@RequiredArgsConstructor
public class FileUploadService {

    private final LeadRepository leadRepository;

    public UploadResponseDTO uploadLeads(MultipartFile file) {

        int totalRecords = 0;
        int successfulRecords = 0;
        int failedRecords = 0;

        try (InputStream is = file.getInputStream();
             Workbook workbook = WorkbookFactory.create(is)) {

            Sheet sheet = workbook.getSheetAt(0);

            for (Row row : sheet) {
                if (row.getRowNum() == 0) continue; // skip header

                totalRecords++;

                try {
                    Lead lead = Lead.builder()
                            .contactNumber(row.getCell(0).getStringCellValue())
                            .firstName(row.getCell(1).getStringCellValue())
                            .city(row.getCell(2).getStringCellValue())
                            .modelName(row.getCell(3).getStringCellValue())
                            .leadSource(row.getCell(4).getStringCellValue())
                            .build();

                    leadRepository.save(lead);
                    successfulRecords++;
                } catch (Exception e) {
                    failedRecords++;
                }
            }

            return UploadResponseDTO.builder()
                    .success(failedRecords == 0)
                    .message("File uploaded successfully. " + successfulRecords + " records processed.")
                    .totalRecords(totalRecords)
                    .successfulRecords(successfulRecords)
                    .failedRecords(failedRecords)
                    .build();

        } catch (Exception e) {
            return UploadResponseDTO.builder()
                    .success(false)
                    .message("File processing failed: " + e.getMessage())
                    .totalRecords(0)
                    .successfulRecords(0)
                    .failedRecords(0)
                    .build();
        }
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\service\LeadService.java -----
package com.hero.leadnurturing.service;

import com.hero.leadnurturing.entity.*;
import com.hero.leadnurturing.repository.LeadModificationRepository;
import com.hero.leadnurturing.repository.LeadRepository;
import com.hero.leadnurturing.dto.DashboardStatsDTO;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.time.LocalDateTime;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

@Service
@RequiredArgsConstructor
public class LeadService {

    private final LeadRepository leadRepository;
    private final LeadModificationRepository leadModificationRepository;

    // ================= CREATE LEAD =================

    public Lead createLead(Lead lead) {
        return leadRepository.save(lead);
    }

    // ================= GET ALL LEADS =================

    public List<Lead> getAllLeads() {
        return leadRepository.findAll();
    }

    // ================= GET LEAD BY ID =================

    public Lead getLeadById(Long id) {
        return leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found with ID: " + id));
    }

    // ================= GET LEADS BY STATUS =================

    public List<Lead> getLeadsByStatus(String status) {
        try {
            LeadStatus leadStatus = LeadStatus.valueOf(status.toUpperCase());
            return leadRepository.findByStatus(leadStatus);
        } catch (IllegalArgumentException e) {
            throw new RuntimeException("Invalid lead status: " + status);
        }
    }

    // ================= GET LEADS BY CITY =================

    public List<Lead> getLeadsByCity(String city) {
        return leadRepository.findByCity(city);
    }

    // ================= GET LEADS BY DATE =================

    public List<Lead> getLeadsBetweenDates(LocalDateTime from, LocalDateTime to) {
        return leadRepository.findByCreatedAtBetween(from, to);
    }

    // ================= UPDATE LEAD WITH AUDIT =================

    public Lead updateLead(Long id, Lead updatedLead, String username) {

        Lead existing = leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found"));

        // Track field changes
        checkAndSaveModification(existing, "city",
                existing.getCity(), updatedLead.getCity(), username);

        checkAndSaveModification(existing, "status",
                existing.getStatus() != null ? existing.getStatus().name() : null,
                updatedLead.getStatus() != null ? updatedLead.getStatus().name() : null,
                username);

        checkAndSaveModification(existing, "modelName",
                existing.getModelName(), updatedLead.getModelName(), username);

        checkAndSaveModification(existing, "followUpDate",
                existing.getFollowUpDate() != null ? existing.getFollowUpDate().toString() : null,
                updatedLead.getFollowUpDate() != null ? updatedLead.getFollowUpDate().toString() : null,
                username);

        // Apply updates
        existing.setCity(updatedLead.getCity());
        existing.setStatus(updatedLead.getStatus());
        existing.setModelName(updatedLead.getModelName());
        existing.setFollowUpDate(updatedLead.getFollowUpDate());

        return leadRepository.save(existing);
    }

    // ================= DELETE LEAD =================

    public void deleteLead(Long id) {
        Lead lead = leadRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Lead not found"));
        leadRepository.delete(lead);
    }

    // ================= HELPER METHOD FOR AUDIT =================

    private void checkAndSaveModification(
            Lead lead,
            String field,
            String oldValue,
            String newValue,
            String username
    ) {

        if (oldValue == null && newValue == null) return;

        if (oldValue == null || !oldValue.equals(newValue)) {

            LeadModification modification = LeadModification.builder()
                    .lead(lead)
                    .modifiedField(field)
                    .oldValue(oldValue)
                    .newValue(newValue)
                    .modifiedBy(username)
                    .build();

            leadModificationRepository.save(modification);
        }
    }

    // ================= GET MODIFICATION HISTORY =================

    public List<LeadModification> getModificationHistory(Long leadId) {

        Lead lead = leadRepository.findById(leadId)
                .orElseThrow(() -> new RuntimeException("Lead not found"));

        return leadModificationRepository.findByLeadOrderByModifiedAtDesc(lead);
    }

    // ================= DASHBOARD STATS =================

    public DashboardStatsDTO getDashboardStats(LocalDateTime from, LocalDateTime to) {

        // If no dates provided  use current month
        if (from == null || to == null) {
            from = LocalDateTime.now()
                    .withDayOfMonth(1)
                    .withHour(0).withMinute(0).withSecond(0);

            to = LocalDateTime.now()
                    .withDayOfMonth(LocalDateTime.now().toLocalDate().lengthOfMonth())
                    .withHour(23).withMinute(59).withSecond(59);
        }

        long total = leadRepository.countByCreatedAtBetween(from, to);

        long qualified = leadRepository.countByStatusAndCreatedAtBetween(
                LeadStatus.QUALIFIED, from, to
        );

        long unqualified = leadRepository.countByStatusAndCreatedAtBetween(
                LeadStatus.UNQUALIFIED, from, to
        );

        long lost = leadRepository.countByStatusAndCreatedAtBetween(
                LeadStatus.LOST, from, to
        );

        long pending = total - (qualified + unqualified + lost);

        double conversion =
                total == 0 ? 0 :
                        ((double) qualified / total) * 100;

        return DashboardStatsDTO.builder()
                .totalLeads(total)
                .qualifiedLeads(qualified)
                .unqualifiedLeads(unqualified)
                .lostLeads(lost)
                .pendingLeads(pending)
                .conversionRate(conversion)
                .sourceDistribution(getLeadsBySource())
                .build();
    }

    // ================= GROUP BY LEAD SOURCE =================

    public Map<String, Long> getLeadsBySource() {

        List<Object[]> results = leadRepository.countLeadsGroupedBySource();

        Map<String, Long> response = new HashMap<>();

        for (Object[] row : results) {
            String source = (String) row[0];
            Long count = (Long) row[1];
            response.put(source, count);
        }

        return response;
    }
}



----- C:\Projects\Tata\leadnurturing\src\main\java\com\hero\leadnurturing\service\UserService.java -----
package com.hero.leadnurturing.service;

import com.hero.leadnurturing.entity.User;
import com.hero.leadnurturing.repository.UserRepository;
import lombok.RequiredArgsConstructor;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

@Service
@RequiredArgsConstructor
public class UserService {

    private final UserRepository userRepository;
    private final PasswordEncoder passwordEncoder;

    public User saveUser(User user) {
        user.setPassword(passwordEncoder.encode(user.getPassword()));
        return userRepository.save(user);
    }

    public User findByUsername(String username) {
        return userRepository.findByUsername(username)
                .orElseThrow(() -> new RuntimeException("User not found"));
    }
}


----- C:\Projects\Tata\leadnurturing\src\main\resources\application.properties -----
spring.application.name=leadnurturing




spring.datasource.url=jdbc:mysql://localhost:3306/leads_db
spring.datasource.username=root
spring.datasource.password= Guddiguddi13@
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=true

server.port=9090

jwt.secret=ThisIsMyVerySecureSecretKeyForHeroProject
jwt.expiration=1800000


----- C:\Projects\Tata\leadnurturing\src\test\java\com\hero\leadnurturing\LeadnurturingApplicationTests.java -----
package com.hero.leadnurturing;

import org.junit.jupiter.api.Test;
import org.springframework.boot.test.context.SpringBootTest;

@SpringBootTest
class LeadnurturingApplicationTests {

	@Test
	void contextLoads() {
	}

}


